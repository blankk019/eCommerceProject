import{a as W}from"./chunk-4OUIY5ME.js";import{a as L}from"./chunk-CFRCYURE.js";import{d as z,h as V,m as R,n as N,o as q,r as j}from"./chunk-ROHYIB4L.js";import{a as B}from"./chunk-K3RX7IXM.js";import{a as A,c as F,i as T}from"./chunk-M5IR3BOK.js";import{i as I,j as k,n as E}from"./chunk-SYWVFSAT.js";import{Db as h,Eb as l,Mb as r,Nb as O,Ob as S,Qb as P,Rb as y,Sb as w,Ub as D,Va as d,Wa as m,e as C,ga as M,hb as v,kb as a,mb as _,qa as u,ra as f,tb as i,ub as n,vb as b,zb as x}from"./chunk-DFJFQNBO.js";function G(c,o){if(c&1){let e=x();i(0,"div",19)(1,"select",20),w("ngModelChange",function(s){u(e);let p=l(2);return y(p.selectedDeliveryDate,s)||(p.selectedDeliveryDate=s),f(s)}),h("change",function(){u(e);let s=l(2);return f(s.onDateSelected(s.selectedDeliveryDate))}),i(2,"option",21),r(3,"Select Date"),n(),i(4,"option",22),r(5,"1 Oct, 2023"),n(),i(6,"option",23),r(7,"2 Oct, 2023"),n(),i(8,"option",24),r(9,"3 Oct, 2023"),n(),i(10,"option",25),r(11,"5 Oct, 2023"),n(),i(12,"option",26),r(13,"8 Oct, 2023"),n(),i(14,"option",27),r(15,"10 Oct, 2023"),n(),i(16,"option",28),r(17,"15 Oct, 2023"),n()()()}if(c&2){let e=l(2);d(),P("ngModel",e.selectedDeliveryDate),d(),a("ngValue",null)}}function U(c,o){if(c&1&&(i(0,"div",29),r(1),n()),c&2){let e=l().$implicit;d(),S(" ",e.deliveryDate," ")}}function H(c,o){c&1&&(i(0,"div",30),b(1,"i",31),n())}function J(c,o){if(c&1){let e=x();i(0,"div",8),h("click",function(){let s=u(e).$implicit,p=l();return f(p.selectShippingMethod(s.id))}),i(1,"div",9)(2,"div",10),b(3,"input",11),n(),i(4,"div",12)(5,"div",13)(6,"span",14),r(7),n(),i(8,"span",15),r(9),n()(),v(10,G,18,2,"div",16),n(),v(11,U,2,1,"div",17)(12,H,2,0,"div",18),n()()}if(c&2){let e=o.$implicit,t=l();_("selected",t.selectedShippingId===e.id),d(3),a("id","shipping-"+e.id)("checked",t.selectedShippingId===e.id)("value",e.id),d(3),_("free-price",e.isFree),d(),S(" ",(e.isFree,e.name)," "),d(2),O(e.description),d(),a("ngIf",e.requiresDateSelection&&t.selectedShippingId===e.id),d(),a("ngIf",!e.requiresDateSelection),d(),a("ngIf",e.requiresDateSelection&&t.selectedShippingId===e.id)}}var $=class c{constructor(o,e,t,s,p){this._CartService=o;this._OrdersService=e;this._AddressService=t;this.route=s;this.router=p}cartId=null;addressId=null;shippingMethods=[];selectedShippingId=null;selectedDeliveryDate=null;showDatePicker=!1;cart=null;subscriptions=new C;ngOnInit(){let o=this.route.parent?.paramMap.subscribe(t=>{this.cartId=t.get("cartId"),console.log("Cart ID in shipping component:",this.cartId)});o&&this.subscriptions.add(o);let e=this.route.paramMap.subscribe(t=>{this.addressId=t.get("addressId"),console.log("Address ID in shipping component:",this.addressId)});this.subscriptions.add(e),this.loadShippingMethods()}ngOnDestroy(){this.subscriptions.unsubscribe()}loadShippingMethods(){this.shippingMethods=[{id:"1",name:"Free",description:"Regulary shipment",price:0,deliveryDate:"17 Oct, 2023",isFree:!0},{id:"2",name:"$8.50",description:"Get your delivery as soon as possible",price:8.5,deliveryDate:"1 Oct, 2023"},{id:"3",name:"Schedule",description:"Pick a date when you want to get your delivery",price:0,deliveryDate:"",requiresDateSelection:!0}],this.selectedShippingId="1"}selectShippingMethod(o){this.selectedShippingId=o;let e=this.shippingMethods.find(t=>t.id===o);e&&!e.requiresDateSelection?(this.selectedDeliveryDate=null,this.showDatePicker=!1):e?.requiresDateSelection&&(this.showDatePicker=!0)}onDateSelected(o){this.selectedDeliveryDate=o}goBack(){this.router.navigate(["../address"],{relativeTo:this.route.parent})}proceedToPayment(){if(!this.cartId||!this.addressId){alert("Missing cart ID or address ID");return}let o=this._AddressService.getAddressById(this.addressId).subscribe({next:e=>{console.log("Address fetched:",e);let t=e.data,s={details:t.details,phone:t.phone,city:t.city};console.log("SingleAddress created:",s);let p=this._OrdersService.checkOutSession(this.cartId,s).subscribe({next:g=>{console.log("Checkout session created:",g),g.session&&g.session.url?window.open(g.session.url,"_blank"):alert("Payment URL not received")},error:g=>{console.error("Error creating checkout session:",g),alert("Failed to create checkout session")}});this.subscriptions.add(p)},error:e=>{console.error("Error fetching address:",e),alert("Failed to fetch address details")}});this.subscriptions.add(o)}proceedToNext(){if(this.shippingMethods.find(e=>e.id===this.selectedShippingId)?.requiresDateSelection&&!this.selectedDeliveryDate){alert("Please select a delivery date");return}this.selectedShippingId&&(console.log("Proceed with shipping method:",this.selectedShippingId),this.selectedDeliveryDate&&console.log("Selected delivery date:",this.selectedDeliveryDate))}static \u0275fac=function(e){return new(e||c)(m(B),m(L),m(W),m(A),m(F))};static \u0275cmp=M({type:c,selectors:[["app-shipping"]],standalone:!0,features:[D],decls:11,vars:2,consts:[[1,"shipping-container"],[1,"shipping-content"],[1,"section-title","mb-4"],[1,"shipping-methods-list"],["class","shipping-card mb-3",3,"selected","click",4,"ngFor","ngForOf"],[1,"navigation-buttons","mt-5"],[1,"btn","btn-back",3,"click"],[1,"btn","btn-next",3,"click","disabled"],[1,"shipping-card","mb-3",3,"click"],[1,"d-flex","align-items-start"],[1,"shipping-radio"],["type","radio","name","selectedShipping",1,"form-check-input",3,"id","checked","value"],[1,"shipping-details","flex-grow-1"],[1,"d-flex","align-items-center","mb-1"],[1,"shipping-price"],[1,"shipping-description","ms-2"],["class","mt-3",4,"ngIf"],["class","shipping-date",4,"ngIf"],["class","shipping-arrow",4,"ngIf"],[1,"mt-3"],[1,"form-select","date-select",3,"ngModelChange","change","ngModel"],["disabled","",3,"ngValue"],["value","2023-10-01"],["value","2023-10-02"],["value","2023-10-03"],["value","2023-10-05"],["value","2023-10-08"],["value","2023-10-10"],["value","2023-10-15"],[1,"shipping-date"],[1,"shipping-arrow"],[1,"bi","bi-chevron-down"]],template:function(e,t){e&1&&(i(0,"div",0)(1,"div",1)(2,"h2",2),r(3,"Shipment Method"),n(),i(4,"div",3),v(5,J,13,12,"div",4),n(),i(6,"div",5)(7,"button",6),h("click",function(){return t.goBack()}),r(8,"Back"),n(),i(9,"button",7),h("click",function(){return t.proceedToPayment()}),r(10," Check out "),n()()()()),e&2&&(d(5),a("ngForOf",t.shippingMethods),d(4),a("disabled",!t.selectedShippingId))},dependencies:[E,I,k,T,j,N,q,R,z,V],styles:[".shipping-container[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:2rem 1rem}.section-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#1a1a1a;margin-bottom:1.5rem}.shipping-methods-list[_ngcontent-%COMP%]{margin-bottom:2rem}.shipping-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:1.5rem;cursor:pointer;transition:all .3s ease}.shipping-card[_ngcontent-%COMP%]:hover{border-color:#ccc;box-shadow:0 2px 4px #0000000d}.shipping-card.selected[_ngcontent-%COMP%]{background:#fff;border-color:#000;border-width:2px;padding:calc(1.5rem - 1px)}.shipping-radio[_ngcontent-%COMP%]{margin-right:1rem;padding-top:.25rem}.shipping-radio[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid #999;cursor:pointer}.shipping-radio[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]:checked{background-color:#000;border-color:#000}.shipping-details[_ngcontent-%COMP%]{flex-grow:1}.shipping-price[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#1a1a1a}.shipping-price.free-price[_ngcontent-%COMP%]{color:#1a1a1a}.shipping-description[_ngcontent-%COMP%]{font-size:14px;color:#999;font-weight:400}.shipping-date[_ngcontent-%COMP%]{font-size:14px;color:#666;font-weight:400;white-space:nowrap;margin-left:1rem}.shipping-arrow[_ngcontent-%COMP%]{margin-left:1rem;color:#999;font-size:14px}.date-select[_ngcontent-%COMP%]{max-width:300px;padding:.5rem .75rem;border:1px solid #e0e0e0;border-radius:4px;font-size:14px;color:#666;background-color:#fff;cursor:pointer;transition:all .2s ease}.date-select[_ngcontent-%COMP%]:focus{border-color:#000;outline:none;box-shadow:0 0 0 2px #0000001a}.date-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{padding:.5rem}.navigation-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem}.btn-back[_ngcontent-%COMP%], .btn-next[_ngcontent-%COMP%]{flex:1;padding:.875rem 2rem;font-size:16px;font-weight:600;border-radius:4px;border:none;cursor:pointer;transition:all .3s ease}.btn-back[_ngcontent-%COMP%]{background-color:#fff;color:#000;border:2px solid #e0e0e0}.btn-back[_ngcontent-%COMP%]:hover{background-color:#f5f5f5;border-color:#ccc}.btn-next[_ngcontent-%COMP%]{background-color:#000;color:#fff}.btn-next[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#333}.btn-next[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed;opacity:.6}@media (max-width: 768px){.shipping-container[_ngcontent-%COMP%]{padding:1rem}.section-title[_ngcontent-%COMP%]{font-size:20px}.shipping-card[_ngcontent-%COMP%]{padding:1rem}.shipping-card.selected[_ngcontent-%COMP%]{padding:calc(1rem - 1px)}.shipping-price[_ngcontent-%COMP%]{font-size:14px}.shipping-description[_ngcontent-%COMP%]{font-size:13px}.shipping-date[_ngcontent-%COMP%]{font-size:13px;margin-left:.5rem}.date-select[_ngcontent-%COMP%]{max-width:100%}.navigation-buttons[_ngcontent-%COMP%]{flex-direction:column}.btn-back[_ngcontent-%COMP%], .btn-next[_ngcontent-%COMP%]{width:100%}.d-flex.align-items-start[_ngcontent-%COMP%]{flex-wrap:wrap}.shipping-date[_ngcontent-%COMP%]{width:100%;margin-left:2.5rem;margin-top:.5rem}}.shipping-card[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%]{align-items:flex-start}@media (min-width: 769px){.shipping-card[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%]{align-items:center}}"]})};export{$ as ShippingComponent};
