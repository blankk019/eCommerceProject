<div class="address-container">
  <div class="address-content">
    <h2 class="section-title mb-4">Select Address</h2>

    <!-- Address List -->
    <div class="addresses-list">
      <!-- Address Cards looped over all addresses -->
      <div
        *ngFor="let address of addresses"
        class="address-card mb-3"
        [class.selected]="selectedAddressId === address._id"
        (click)="selectAddress(address._id)"
      >
        <div class="d-flex align-items-start">
          <!-- Radio Button -->
          <div class="address-radio">
            <input
              type="radio"
              [id]="'address-' + address._id"
              [checked]="selectedAddressId === address._id"
              [value]="address._id"
              name="selectedAddress"
              class="form-check-input"
            />
          </div>

          <!-- Address Content -->
          <div
            class="address-details flex-grow-1 d-flex justify-content-between align-items-center"
          >
            <div class="details">
              <div class="d-flex align-items-center mb-2">
                <h5 class="address-name mb-0">{{ address.city }}</h5>
                <span class="address-type-badge ms-2">{{ address.name }}</span>
              </div>
              <p class="address-text mb-1">{{ address.details }}</p>
              <p class="address-phone mb-0">{{ address.phone }}</p>
            </div>
            <div class="actions">
              <button class="btn" (click)="deleteAddress(address._id)">
                <i class="fa-solid fa-circle-minus"></i>
              </button>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="address-actions">
            <button
              class="btn-action btn-edit"
              (click)="editAddress(address._id); $event.stopPropagation()"
              title="Edit address"
            >
              <i class="bi bi-pencil"></i>
            </button>
            <button
              class="btn-action btn-delete ms-2"
              (click)="deleteAddress(address._id); $event.stopPropagation()"
              title="Delete address"
            >
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add New Address Button -->
    <div class="add-address-section">
      <button class="btn-add-address" (click)="openAddForm()">
        <i class="fa-solid fa-circle-plus"></i>
      </button>
    </div>

    @if (addFormOpen) {
    <form [formGroup]="addForm" (ngSubmit)="onSubmit()">
      <div class="mb-3">
        <label for="name" class="form-label">Type of Address</label>
        <input
          type="text"
          id="name"
          formControlName="name"
          class="form-control"
        />
      </div>
      <div class="mb-3">
        <label for="city" class="form-label">City</label>
        <input
          type="text"
          id="city"
          formControlName="city"
          class="form-control"
        />
      </div>
      <div class="mb-3">
        <label for="details" class="form-label">Details</label>
        <textarea
          id="details"
          formControlName="details"
          class="form-control"
        ></textarea>
      </div>
      <div class="mb-3">
        <label for="phone" class="form-label">Phone</label>
        <input
          type="text"
          id="phone"
          formControlName="phone"
          class="form-control"
        />
      </div>
      <button
        type="submit"
        class="btn"
        style="background-color: #000; color: #fff"
      >
        Add Address
      </button>
    </form>
    }

    <!-- Navigation Buttons -->
    <div class="navigation-buttons mt-5">
      <button class="btn btn-back" (click)="goBack()">Back</button>
      <button
        class="btn btn-next"
        (click)="proceedToNext()"
        [disabled]="!selectedAddressId"
        routerLink="/checkout/shipping"
        routerLinkActive="active"
      >
        Next
      </button>
    </div>
  </div>
</div>
